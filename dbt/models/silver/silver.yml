version: 2

models:
  - name: crm_cust_info
    description: "Cleaned and transformed customer info from bronze.crm_cust_info"
    columns:
      - name: cst_id
        description: "Primary key of customer"
        tests:
          - unique
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: integer

      - name: cst_firstname
        description: "Customer first name"
        tests:
          - not_null
          - dbt_utils.not_empty_string
          - dbt_expectations.expect_column_values_to_match_regex:
              arguments:
                regex: "^[A-Za-zÀ-ÿ\\s\\-]+$"

      - name: cst_lastname
        description: "Customer last name"
        tests:
          - not_null
          - dbt_utils.not_empty_string
          - dbt_expectations.expect_column_values_to_match_regex:
              arguments:
                regex: "^[A-Za-zÀ-ÿ\\s\\-]+$"

      - name: cst_gndr
        description: "Customer gender (Male/Female/n/a)"
        tests:
          - accepted_values:
              arguments:
                values: ["Male", "Female", "n/a"]

      - name: cst_marital_status
        description: "Customer marital status"
        tests:
          - accepted_values:
              arguments:
                values: ["Single", "Married", "n/a"]

      - name: cst_create_date
        description: "Record creation date"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: "'2025-01-01'"

  - name: crm_prd_info
    description: "Silver table with cleaned and enriched product information"
    columns:
      - name: prd_id
        description: "Primary key of the product"
        tests:
          - unique
          - not_null

      - name: cat_id
        description: "Derived category ID from product key"
        tests:
          - not_null

      - name: prd_key
        description: "Cleaned product key for analytics"
        tests:
          - not_null

      - name: prd_nm
        description: "Cleaned product name"
        tests:
          - not_null

      - name: prd_cost
        description: "Product cost, nulls replaced with zero"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0

      - name: prd_line
        description: "Friendly product line after mapping codes to names"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_in_set:
              arguments:
                value_set: ['Mountain', 'Road', 'Other Sales', 'Touring', 'n/a']

      - name: prd_start_dt
        description: "Start date for product validity"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date

      - name: prd_end_dt
        description: "End date calculated from lead function"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date

      - name: dwh_create_date
        description: "Date when data was loaded into the Silver layer"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date


  - name: crm_sales_details
    description: "Silver table with cleaned and transformed sales details"
    columns:
      - name: sls_ord_num
        description: "Order number"
        tests:
          - not_null
          - unique

      - name: sls_prd_key
        description: "Product key, links to crm_prd_info"
        tests:
          - not_null
          - relationships:
              to: ref('crm_prd_info')
              field: prd_key

      - name: sls_cust_id
        description: "Customer ID, links to crm_cust_info"
        tests:
          - not_null
          - relationships:
              to: ref('crm_cust_info')
              field: cst_id

      - name: sls_order_dt
        description: "Order date (cast from integer to date)"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date

      - name: sls_ship_dt
        description: "Shipping date (cast from integer to date)"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date

      - name: sls_due_dt
        description: "Due date (cast from integer to date)"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date

      - name: sls_quantity
        description: "Quantity sold, must be positive"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 1

      - name: sls_price
        description: "Price per unit, must be positive"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0.01

      - name: sls_sales
        description: "Total sales amount, must equal quantity * price and be positive"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              arguments:
                min_value: 0.01

      - name: dwh_create_date
        description: "Date when data was loaded into the Silver layer"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              arguments:
                column_type: date







  - name: erp_cust_az12
    description: "Cleaned customer table in the Silver layer"
    columns:
      - name: cid
        description: "Unique customer identifier"
        tests:
          - not_null
          - unique

      - name: bdate
        description: "Cleaned customer birthdate"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: '1900-01-01'
              max_value: current_date

      - name: gen
        description: "Standardized gender"
        tests:
          - not_null
          - accepted_values:
              values: ['Male', 'Female', 'n/a']

  - name: erp_loc_a101
    description: "Cleaned customer location table in the Silver layer"
    columns:
      - name: cid
        description: "Customer identifier referencing erp_cust_az12"
        tests:
          - not_null
          - relationships:
              to: ref('silver_erp_customer')
              field: sid

      - name: cntry
        description: "Normalized country name"
        tests:
          - not_null

  - name: erp_px_cat_g1v2
    description: "Cleaned product categories in the Silver layer"
    columns:
      - name: id
        description: "Unique category identifier"
        tests:
          - not_null
          - unique

      - name: cat
        description: "Main product category"
        tests:
          - not_null
          - accepted_values:
              values: ['Accessories', 'Bikes', 'Clothing', 'Components']

      - name: subcat
        description: "Product subcategory"
        tests:
          - not_null

      - name: maintenance
        description: "Maintenance flag"
        tests:
          - not_null
          - accepted_values:
              values: ['Yes', 'No']



